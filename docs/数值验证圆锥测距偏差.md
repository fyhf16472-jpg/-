# 圆锥测距非线性最小二乘偏差数值验证（修订稿）

本文档对原始报告《数值验证圆锥测距偏差.docx》的逻辑进行了梳理与压缩，并补充了可重复的 MATLAB 验证步骤。目的是让读者能够快速复现圆锥测距几何下非线性最小二乘（NLS）估计的偏差，并对比二阶解析近似与蒙特卡洛结果的一致性。

## 1. 问题背景
- 距离观测模型对应三维空间中的圆锥流形，非线性导致有限样本下的系统性偏差。
- GNSS-A 等“单侧布站”或“弱垂直约束”场景尤为敏感，垂向偏差可能达到厘米量级。
- 对称几何（完整环绕观测）可显著抑制偏差，而单侧弧段会放大偏差。

## 2. 模型与符号
- 真值：\(\mathbf{x} = [x, y, z]^\top\)（单位：m），深度以负号表示。
- 观测：\( \rho_i = \|\mathbf{x} - \mathbf{s}_i\| + \epsilon_i \)，其中 \(\mathbf{s}_i\) 为船位坐标，\(\epsilon_i \sim \mathcal{N}(0, \sigma^2)\)。
- 目标：通过最小化 \( \sum_i (\rho_i - \|\mathbf{x} - \mathbf{s}_i\|)^2 \) 估计 \(\mathbf{x}\)。

## 3. 偏差近似
- 一阶解 \( \delta_1 = (J^\top J)^{-1} J^\top \epsilon \) 期望为零，不能解释系统性偏差。
- 二阶修正可写成  
  \[
  \mathbf{b} \approx -\tfrac{1}{2}(J^\top J)^{-1} \sum_i J_i^\top \operatorname{tr}(H_i \Sigma_\delta),
  \]
  其中 \(J\) 为雅可比矩阵，\(H_i\) 为第 \(i\) 个观测的 Hessian，\(\Sigma_\delta = \sigma^2 (J^\top J)^{-1}\) 是一阶解的协方差。该式捕获了流形曲率带来的漂移。

## 4. MATLAB 验证步骤
1. 打开 `matlab/cone_range_bias_sim.m`，根据需求调整参数：
   - `sigma`：距离噪声标准差（m）。
   - `nTrials`：蒙特卡洛次数。
   - `symmetric`：`false` 表示单侧弧段（放大偏差），`true` 表示全向对称。
2. 在 MATLAB 或 GNU Octave 运行：  
   ```matlab
   results = cone_range_bias_sim(struct('sigma',0.5,'nTrials',5000,'symmetric',false));
   ```
3. 输出包含：
   - `biasMC`：蒙特卡洛估计的偏差。
   - `biasTheory`：二阶近似预测的偏差。
   - `covMC`：估计协方差。
4. 通过切换 `symmetric` 观察对称几何对偏差的抑制效果。

## 5. 预期结论
- 非对称弧段几何会产生明显的垂向偏差，且与二阶解析近似吻合。
- 对称布站时，理论偏差与蒙特卡洛偏差都接近零，验证了“几何对称性消除偏差”的观点。
- 噪声越大或几何越退化，二阶项贡献越显著；可按需增加 `nTrials` 提高稳定性。

## 6. 后续扩展
- 将船位从圆弧拓展到真实航迹（折线或漂移轨迹），以评估工程场景。
- 接入实测声学距离或 GNSS-A 数据，对估计结果先减去 `biasTheory` 作为无偏修正。
- 引入多换能器/多目标情形，验证矩阵耦合下的偏差传播。
